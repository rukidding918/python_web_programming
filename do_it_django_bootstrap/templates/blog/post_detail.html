{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
    {% if post.head_image %}
        <img src="{{ post.head_image.url }}" alt="">
    {% else %}
        <img class="card-img-top" src="https://picsum.photos/seed/{{ post.id }}/800/200" alt="Card image cap">
    {% endif %}
    <h1>{{ post }}</h1>
    <h4>{{  post.created_at }}</h4>
    <div>by {{ post.author|upper }}</div>
    {% if user.is_authenticated and user == post.author %}
        <a href="{% url 'blog:update_post' post.pk %}" class="btn btn-info btn-sm float-right" role="button">Edit post</a>
    {% endif %}
    <p>{{ post.content|linebreaks }}</p>
    {% if post.file_upload %}
        <a href="{{ post.file_upload.url }}" class="btn btn-outline-dark" role="button">Download</a>
    {% endif %}
    <hr>

    <!-- Comments Form -->
        <div class="card my-4">
          <h5 class="card-header">Leave a Comment:</h5>
          <div class="card-body">
            {% if user.is_authenticated %}
            <form id="comment-form" method="POST" action="{{ post.get_absolute_url }}">{% csrf_token %}
              <div class="form-group">
                  {{ comment_form|crispy }}
              </div>
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            {% else %}
                <a href="#" class="btn btn-outline-dark btn-block btn-sm" data-toggle="modal" data-target="#loginModal">Log in and leave a comment</a>
            {% endif %}
          </div>
        </div>

    {% if post.comment_set.exists %}
        {% for comment in post.comment_set.iterator %}

            <!-- Single Comment -->
            <div class="media mb-4" id="comment-{{ comment.pk }}">
              <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
              <div class="media-body">
                <h5 class="mt-0">{{ comment.author.username }} <small class="text-muted">{{ comment.created_at }}</small></h5>
                <p>{{ comment.content|linebreaks }}</p>
              </div>
            </div>

        {% endfor %}
    {% endif %}
{% endblock %}